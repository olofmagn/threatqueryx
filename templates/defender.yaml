failed_logins:
  description: "Identify failed sign-in attempts in Defender logs."
  base: "IdentityLogonEvents"
  required_fields:
    - "LogonType == 'Interactive' and ActionType == 'LogonFailed'"
  optional_fields:
    username:
      pattern: "AccountName == '{value}'"
      help: "Username that failed to sign in"
    source_ip:
      pattern: "IPAddress == '{value}'"
      help: "Source IP address of the logon attempt"
      validation: "ip"
  post_pipeline: "project AccountName, DeviceName, IPAddress, Timestamp"

phishing_site:
  description: "Identify network connections to potential phishing domains"
  base: "DeviceNetworkEvents"
  required_fields:
    - "ActionType == 'ConnectionSuccess'"
  optional_fields:
    domain:
      pattern: "RemoteUrl contains '{value}'"
      help: "The domain being connected to"
  post_pipeline: "project InitiatingProcessAccountUpn, DeviceName, RemoteUrl, Timestamp, DeviceId"

dns_exfiltration:
  description: "Look for long suspicious DNS queries that may indicate exfiltration."
  base: "DeviceNetworkEvents"
  required_fields:
    - "ActionType == 'ConnectionSuccess'"
    - "strlen(RemoteUrl) > 100"
  optional_fields:
    domain:
      pattern: "RemoteUrl contains '{value}'"
      help: "Suspicious domain to hunt for"
  post_pipeline: "project DeviceName, RemoteUrl, Timestamp, InitiatingProcessAccountUpn"

rce_attempts:
  description: "Search for suspicious remote command execution patterns."
  base: "DeviceProcessEvents"
  required_fields:
    - "FileName has_any('powershell.exe', 'cmd.exe', 'wscript.exe', 'cscript.exe')"
    - "ProcessCommandLine has_any('Invoke-WebRequest', 'IEX', 'curl', 'wget', 'base64')"
  optional_fields:
    username:
      pattern: "AccountName == '{value}'"
      help: "Account executing suspicious commands"
  post_pipeline: "project AccountName, DeviceName, FileName, ProcessCommandLine, Timestamp"